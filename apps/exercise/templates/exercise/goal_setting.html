{% extends "exercise/base.html" %}
{% block title %}目標設定{% endblock %}
{% block content %}

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<div class="container my-5">
    <a class="menu-btn btn-secondary mb-4" href="{{ url_for('exercise.index') }}">メニューへ戻る</a>
    <p></p>
    <a href="{{ url_for('exercise.mode_select') }}">モード選択に戻る</a>

    <header class="text-center mb-4">
        <h2>目標設定</h2>
    </header>
    <section>
        <form id="goalForm" action="{{ url_for('exercise.goal_setting') }}" method="POST" novalidate="novalidate" class="card p-4 shadow">
            {{ form.csrf_token }}

            <!-- 目標期間 -->
            <div class="mb-3">
                <label for="form-period" class="form-label">目標期間</label>
                <div class="input-group">
                    {{ form.period(id="form-period", class="form-control", placeholder="目標期間") }}
                    <span class="input-group-text">日</span>
                </div>
                {% for error in form.period.errors %}
                <div class="text-danger small">{{ error }}</div>
                {% endfor %}
            </div>

            <!-- 目標体重 -->
            <div class="mb-3">
                <label for="form-goalweight" class="form-label">目標体重</label>
                <div class="input-group">
                    {{ form.goalweight(id="form-goalweight", class="form-control", placeholder="目標体重") }}
                    <span class="input-group-text">kg</span>
                </div>
                {% for error in form.goalweight.errors %}
                <div class="text-danger small">{{ error }}</div>
                {% endfor %}
            </div>

            <!-- 週の利用日数 -->
            <div class="mb-3">
                <label for="form-numberexercisesweek" class="form-label">１週間の運動回数</label>
                <div class="input-group">
                    {{ form.numberexercisesweek(id="form-numberexercisesweek", class="form-control", placeholder="１週間の運動回数") }}
                    <span class="input-group-text">日</span>
                </div>
                {% for error in form.numberexercisesweek.errors %}
                <div class="text-danger small">{{ error }}</div>
                {% endfor %}
            </div>

            <!-- 送信ボタン -->
            <div class="d-grid">
                <button type="button" class="btn btn-primary btn-block" data-toggle="modal" data-target="#confirmationModal">
                    入力内容を確認する
                </button>
            </div>
        </form>
    </section>
</div>

<!-- 確認用モーダル -->
<div class="modal fade" id="confirmationModal" tabindex="-1" role="dialog" aria-labelledby="confirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmationModalLabel">入力内容の確認</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="閉じる">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>以下の内容でお間違いないないですか？</p>

                <p><strong>モード:</strong>{{mode}}モード</p>
                <p><strong>目標期間:</strong> <span id="confirm-period"></span> 日</p>
                <p><strong>目標体重:</strong> <span id="confirm-goalweight"></span> kg</p>
                <p><strong>１週間の運動回数:</strong> <span id="confirm-numberexercisesweek"></span> 日</p>
                <font color="#ff0000"><p>※目標期間が終了するまで、プランの新規登録、</p>
                <p>　編集、削除は行えません。</p>
                </font>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">戻る</button>
                <button type="button" class="btn btn-primary" id="finalSubmit">送信する</button>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const form = document.getElementById('goalForm');
    const finalSubmitButton = document.getElementById('finalSubmit');

    // モーダル表示時に入力内容を表示
    $('#confirmationModal').on('show.bs.modal', function () {
        document.getElementById('confirm-period').textContent = form.period.value;
        document.getElementById('confirm-goalweight').textContent = form.goalweight.value;
        document.getElementById('confirm-numberexercisesweek').textContent = form.numberexercisesweek.value;
    });

    // 最終送信ボタン
    finalSubmitButton.addEventListener('click', function() {
        form.submit();
    });
});
</script>
{% endblock %}
